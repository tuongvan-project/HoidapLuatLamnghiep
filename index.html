<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Hỏi đáp Pháp luật Lâm nghiệp</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
    /* --- Cài đặt biến màu sắc và các giá trị cơ bản --- */
        :root {
            --primary-color: #2e7d32;
            --secondary-color: #43a047;
            --background-color: #f1f8e9;
            --text-color: #433;
            --correct-color: #4caf50;
            --incorrect-color: #f44336;
            --timer-color: #e57370;
            --text-on-light-bg: #333;
            --text-on-dark-bg: white;
            /* Cỡ chữ co giãn (fluid typography) */
            --font-size-sm: clamp(0.8rem, 1.5vw, 1rem);
            --font-size-md: clamp(1rem, 2vw, 1.25rem);
            --font-size-lg: clamp(1.15rem, 2.25vw, 1.5rem);
            --font-size-xl: clamp(1rem, 3vw, 2rem);
        }
/* --- Khai báo font chữ thứ nhất --- */
@font-face {
  font-family: 'End'; /* Đặt tên tùy ý cho font */
  src: url('End.woff2') format('woff2'),
       font-weight: normal;
  font-style: normal;
  font-display: swap; /* Giúp hiển thị nhanh hơn và tránh lỗi FOIT/FOUT */
}
/* --- Khai báo font chữ thứ hai --- */
@font-face {
  font-family: 'Result'; 
  src: url('Result.woff2') format('woff2'),
       font-weight: normal;
  font-style: normal;
  font-display: swap; 
}
/* --- Khai báo font chữ thứ ba --- */
@font-face {
  font-family: 'Viettay'; 
  src: url('Viettay.woff2') format('woff2'),
       font-weight: normal;
  font-style: normal;
  font-display: swap; 
}
/* --- Khai báo font chữ thứ tư --- */
@font-face {
  font-family: 'ViettayBold'; 
  src: url('ViettayBold.woff2') format('woff2'),
       font-weight: normal;
  font-style: normal;
  font-display: swap; 
}

/* --- CSS CHO LỚP PHỦ TỐI --- */
#dim-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6); /* Màu đen với độ trong suốt 60% */
    z-index: 14; /* Nằm dưới overlay đáp án nhưng trên các thành phần khác */
    display: none; /* Ẩn theo mặc định */
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
}

#dim-overlay.active {
    display: block;
    opacity: 1;
}



#evaluation-text {
    font-family: 'End', sans-serif;
    color: black; /* Ví dụ: màu xanh lá cây, phù hợp với màu chính của game */
    
    /* Chỉnh cỡ chữ */
    font-size: clamp(1rem, 4vw, 2rem); /* Tùy chỉnh:
                                           - 1.5rem: cỡ nhỏ nhất trên điện thoại
                                           - 4vw: co giãn theo chiều rộng màn hình
                                           - 2.5rem: cỡ lớn nhất trên máy tính */
width: 100%; /* Chiếm toàn bộ chiều ngang của thẻ cha */
    line-height: 1.2; /* Tùy chỉnh line-height để tránh tràn viền */
    margin: 0; /* Xóa margin không mong muốn */
    padding: 0; /* Xóa padding không mong muốn */
}
/* --- CSS cho khung nội dung About Me --- */
#about-me-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%; /* Chiều rộng khung nội dung */
    height: 60%; /* Chiều cao khung nội dung */
    padding: 2% 5%; /* Khoảng cách lề bên trong khung */
    text-align: center;
    color: #433;
    overflow-y: auto; /* Cho phép cuộn nếu nội dung dài */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    opacity: 0; /* Ẩn đi lúc đầu */
    transition: opacity 0.5s ease; /* Hiệu ứng mờ ảo khi hiện ra */
    /* --- Thêm dòng dưới đây --- */
    }
.letter-title {
font-family: 'ViettayBold', sans-serif;
    font-size: clamp(1.7rem, 4vw, 2.3rem);
    font-weight: bold;
    margin-bottom: 0rem;
}

.letter-body {
font-family: 'Viettay', sans-serif;  
 font-size: clamp(1.2rem, 3.2vw, 1.8rem);
    line-height: 1.2;
    white-space: pre-wrap; /* Giúp xuống dòng tự động và giữ khoảng cách */
}
.letter-body p {
    margin-top: 0.2rem;
    margin: 0; 
    /* Đặt margin-bottom để tạo khoảng cách giữa các khổ chữ */
    margin-bottom: 0.1rem; 
}
.letter-body p:first-child {
    margin-top: 0;
}

/* --- Thiết lập lại CSS và Body --- */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--background-color);
    background-image: url('Background.webp');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: var(--text-color);
    display: flex;
    justify-content: center;
    align-items: flex-start;
    width: 100%;
    min-height: 100svh;
    min-height: calc(var(--vh, 1vh) * 100);
    overflow-y: auto;
    position: relative;
    padding-top: 1vh; /* Thêm padding để tránh nội dung bị che bởi các thành phần trên cùng */
}

/* --- Màn hình bắt đầu --- */
.start-screen {
    position: fixed; /* Đặt lại thành fixed để bao phủ toàn bộ màn hình */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 30;
    background-image: url('Background0.jpg');
    background-size: cover;
    background-position: center;
    padding: 1rem;
    transition: opacity 1s ease-in-out;
}

.start-screen.hidden {
    opacity: 0;
    pointer-events: none;
}
        
.logo-container {
    position: absolute;
    top: 1vh;
    left: 1vw;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    z-index: 35;
}

.logo-container img {
    width: clamp(60px, 10vw, 100px);
    height: auto;
    margin-bottom: 0.5vh;
}

.logo-container p {
    font-size: clamp(0.6rem, 1.2vw, 0.9rem);
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    white-space: nowrap; /* Ngăn chữ bị xuống dòng */
}

.author-info {
    position: absolute;
    bottom: 0.5vh;
    right: 1vw;
    font-size: clamp(0.6rem, 1.2vw, 0.9rem);
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    z-index: 35;
    white-space: nowrap;
}
        
.game-title-img {
    width: 90%;
    max-width: 600px;
    height: auto;
    animation: fadeInScale 2s ease-in-out forwards;
    margin-bottom: 2rem;
}
        
.start-btn {
    background-color: #4caf50;
    color: white;
    font-size: var(--font-size-lg);
    padding: 0.75em 2em;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 9px #388e3c;
    text-transform: uppercase;
    font-weight: 700;
    font-family: 'Press Start 2P', cursive;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    animation: fadeInScale 2s ease-in-out 0.5s forwards;
    opacity: 0;
}

.start-btn:hover {
    background-color: #43a047;
    box-shadow: 0 7px #388e3c;
    transform: translateY(2px);
}

.start-btn:active {
    background-color: #388e3c;
    box-shadow: 2px 2px #388e3c;
    transform: translateY(7px);
}

/* --- Container chính của Game --- */
.container {
    width: 100%;
    min-height: 100svh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 1vh 2vw 2vh; /* Cải thiện padding cho mobile */
    position: relative;
    overflow-x: hidden;
}
        
/* Container chứa cả khung đồng hồ và số */
#clock-container {
    position: absolute;
    top: 0vh;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    width: clamp(80px, 12vw, 120px);
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Khung ảnh đồng hồ */
#clock-frame {
    width: 100%;
    height: auto;
}

/* Phần hiển thị số giây */
#timer-container {
    position: absolute;
    top: 56%;
    left: 50%;
    transform: translate(-50%, -50%);
}
        
#timer {
    font-size: clamp(1rem, 3.5vw, 2rem);
    font-weight: bold;
    color: #ffc107;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}
        
.exit-btn, .replay-btn {
    position: absolute;
    bottom: 2vh;
    left: 1vw;
    font-size: clamp(0.7rem, 2vw, 1rem);
    padding: 0.5em 1.5em;
    background-color: #f44336;
    z-index: 25;
    color: white; border: none; border-radius: 50px; cursor: pointer;
    box-shadow: 0 5px #c62828; font-family: 'Press Start 2P', cursive;
}
.exit-btn:hover, .replay-btn:hover { background-color: #e53935; transform: translateY(2px); box-shadow: 0 3px #c62828;}
.exit-btn:active, .replay-btn:active { background-color: #c62828; transform: translateY(4px); box-shadow: 0 1px #c62828;}

/* CSS cho nút Replay */
.exit-btn, .replay-btn {
    position: absolute;
    left: 1vw;
    z-index: 25;
    cursor: pointer;

    /* Loại bỏ các thuộc tính của nút văn bản cũ */
    background-color: transparent;
    border: none;
    box-shadow: none;
    padding: 0; /* Xóa padding */

    /* Kích thước và hiệu ứng chuyển động */
    width: clamp(40px, 8vw, 60px); /* Cùng kích thước với nút Replay */
    height: auto;
    transition: transform 0.2s ease-in-out;
}

/* Thiết lập vị trí riêng cho từng nút */
.exit-btn {
    bottom: 12vh; /* Nút Home ở dưới */
}
.replay-btn {
    bottom: 22vh; /* Nút Replay ở trên */
}

/* Đảm bảo ảnh bên trong lấp đầy nút */
.exit-btn img, .replay-btn img {
    width: 100%;
    height: auto;
    display: block; /* Thêm display block để loại bỏ khoảng trống thừa */
}

/* Hiệu ứng khi di chuột và nhấn chuột */
.exit-btn:hover, .replay-btn:hover {
    transform: scale(1.1);
    background-color: transparent; /* Đảm bảo nền vẫn trong suốt */
    box-shadow: none;
}
.exit-btn:active, .replay-btn:active {
    transform: scale(1.05);
    background-color: transparent;
    box-shadow: none;
}        
.quiz-wrapper {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 12vh;
    flex-grow: 1; /* Cho phép quiz-wrapper chiếm phần không gian còn lại */
}
        
.question-frame {
    width: clamp(300px, 85vw, 900px); /* Tăng chiều rộng tối đa */
    min-height: 150px;
    height: auto;
    background-image: url('Cauhoi.png');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    background-position: center;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 5% 8%; /* Giảm padding ngang từ 12% xuống 8% */
    margin-bottom: 2rem;
}        
.question-card {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: var(--text-color);
    overflow-y: auto;
}

.question-text {
    font-size: clamp(1rem, 3.5vw, 1.5rem);
    font-weight: 600;
    line-height: 1.5;
    white-space: pre-wrap;
    padding: 0.5rem;
}

/* Bố cục mặc định cho màn hình dọc (1 cột) */
.answers {
    width: clamp(300px, 90vw, 900px);
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
    z-index: 5;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
    padding: 0 1rem;
}
        
/* Bố cục cho màn hình ngang (2 cột) */
@media (orientation: landscape) {
    .answers {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
}
        
.answers.visible {
    opacity: 1;
}
        
.answer-btn {
    background-color: transparent;
    color: var(--text-color);
    padding: 1rem;
    text-align: center;
    cursor: pointer;
    font-size: clamp(0.9rem, 2.8vw, 1.1rem);
    font-weight: 500;
    width: 100%;
    min-height: 72px;
    display: flex;
    justify-content: center;
    align-items: center;
    line-height: 1.4;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out, filter 0.2s, background-image 0.3s ease;
    border: none;
    background-image: url('Textbox.png');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    background-position: center;
}

.answer-btn.show {
    opacity: 1;
    transform: translateY(0);
}
        
.answer-btn:hover {
    transform: translateY(-2px) scale(1.02);
    filter: brightness(1.1);
}
        
.answer-btn.correct {
    background-image: url('Textbox_Correct.png');
}

.answer-btn.incorrect {
    background-image: url('Textbox_Incorrect.png');
}
        
.answer-btn.disabled { pointer-events: none; opacity: 0.8; }

/* --- Màn hình kết quả và các thành phần khác --- */
.results-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    width: 90%;
    max-width: 400px;
    background-color: rgba(255, 255, 255, 0.9);
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    z-index: 20;
    animation: fadeIn 1s ease-in-out;
}
        
.result-text {
   font-family: 'Result', sans-serif; 
font-size: var(--font-size-lg);
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 1.5rem;
}

.restart-btn {
    background-color: var(--secondary-color);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: var(--font-size-md);
    margin-top: 1rem;
    transition: background-color 0.3s, transform 0.2s;
}

.restart-btn:hover { background-color: var(--primary-color); }
        
.chibi-assistant {
    position: fixed;
    bottom: 0;
    right: 0;
    width: clamp(150px, 20vw, 250px);
    height: auto;
    z-index: 15;
    pointer-events: none;
}
        
.chibi-assistant video { width: 100%; height: auto; display: block; }
        
.next-btn {
    position: fixed;  
    bottom: calc(env(safe-area-inset-bottom) + 12px);
    left: 50%;
    transform: translateX(-50%);
    background-color: transparent;
    border: none;
    cursor: pointer;
    z-index: 999;  
    transition: transform 0.2s ease-in-out;
}

.next-btn img {
    width: clamp(56px, 9vw, 90px);
    height: auto;
}

.next-btn:hover { transform: translateX(-50%) scale(1.1); }

.overlay-answer {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.1);
    width: clamp(300px, 80vw, 800px);
    height: auto;
    background-image: url('Dapan.png');
    background-size: 100% 100%;
    background-position: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: var(--text-color);
    font-size: var(--font-size-lg);
    font-weight: bold;
    z-index: 15;
    opacity: 0;
    pointer-events: none;
    padding: 4%;
    overflow-y: auto;
}

.overlay-answer.active {
    animation: zoomIn 0.5s ease-out forwards;
    pointer-events: auto;
}

.overlay-text { 
    white-space: pre-wrap; 
    opacity: 0; 
    line-height: 1.4;
    font-size: clamp(1rem, 3.5vw, 1.5rem);
}

/* --- Bảng hiển thị điểm (ĐÃ SỬA LỖI) --- */
#score-board {
    position: absolute;
    top: 1vh;
    right: 1vw;
    width: clamp(95px, 20vw, 140px);
    z-index: 20;
    pointer-events: none;
    opacity: 0;
    transition: opacity 1s ease-in-out;
}
        
#score-board.active {
    opacity: 1;
}

.score-board-frame {
    width: 100%;
    height: auto;
    display: block;
}
        
.score-text-container {
    position: absolute;
    width: 100%;
    top: 78%;
    left: 43%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
}

#correct-count {
    font-family: 'Press Start 2P', cursive;
    font-size: clamp(0.5rem, 1vw, 1.0rem);
    font-weight: bold;
    color: #007bff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    line-height: 1.2;
    margin: 0.1em 0;
}

#incorrect-count {
    font-family: 'Press Start 2P', cursive;
    font-size: clamp(0.5rem, 1vw, 1.0rem);
    font-weight: bold;
    color: #dc3545;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    line-height: 1.2;
    margin: 0.1em 0;
}

/* --- Animations --- */
@keyframes fadeInScale {
    0% { transform: scale(0.1); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}
@keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -40%); }
    to { opacity: 1; transform: translate(-50%, -50%); }
}
@keyframes zoomIn {
    0% { transform: translate(-50%, -50%) scale(0.1); opacity: 0; }
    80% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}
        
#overlay-explanation {
    font-size: clamp(0.8rem, 2.5vw, 1.1rem);
    font-weight: normal; 
    font-style: italic;
    color: var(--text-color);
    line-height: 1.5;
    margin-top: 10px;
    opacity: 0;
    transition: opacity 1s;
}

#overlay-answer-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 5%;
    height: 100%;
    width: 100%;
}
        
/* --- Media Queries cho màn hình nhỏ hơn --- */
@media (max-width: 768px) {
    .chibi-assistant {
        width: 80px; /* Chibi sẽ có chiều rộng 100px trên màn hình nhỏ */
    }
    .question-frame {
        height: auto;
        min-height: 120px;
        width: clamp(280px, 90vw, 600px);
        padding: 5% 10%;
        margin-bottom: 0.75rem;
    }
    .quiz-wrapper {
        padding-top: 15vh;
    }
    #score-board {
        top: 2vh;
        width: clamp(100px, 25vw, 150px);
    }
    
    .logo-container {
        top: 2vh;
    }
    .overlay-answer {
        width: clamp(300px, 90vw, 800px);
        padding: 8% 5%;
    }
.fade-out {
    opacity: 0;
    transition: opacity 0.5s ease-out; /* Thời gian chuyển cảnh là 0.5 giây */
}

.fade-in {
    opacity: 1;
    transition: opacity 0.5s ease-in;
}
}
  /* --- CSS Các phần tử mới cho Menu và About Me (ĐÃ SỬA) --- */
#menu-container {
    position: absolute;
    bottom: 2vh;
    left: 1vw;
    z-index: 35;
    /* Sử dụng flex để căn chỉnh nút và khay menu */
    display: flex;
    align-items: center; /* Căn giữa các item theo chiều dọc */
}

.menu-btn {
    background-color: transparent;
    border: none;
    cursor: pointer;
    width: clamp(40px, 8vw, 60px);
    height: auto;
    transition: transform 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Đảm bảo nút menu luôn ở trên khay */
    z-index: 2; 
}
.menu-btn img {
    width: 100%;
    height: auto;
}
.menu-btn:hover { transform: scale(1.1); }

#menu-tray {
    position: absolute;
    /* Vị trí bắt đầu: bên trái của container (tức là cạnh phải của nút menu) */
    left: 100%; 
    bottom: 0; /* Căn đáy khay với đáy của container */
    display: flex;
    align-items: center;
    height: auto; 

    /* Trạng thái ẩn ban đầu */
    opacity: 0;
    transform: translateX(-20%); /* Hơi lùi về trái để tạo hiệu ứng trượt ra */
    pointer-events: none; /* Không thể tương tác khi đang ẩn */
    transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
}
#menu-tray.active {
    /* Trạng thái hiện: trượt về đúng vị trí và hiện ra */
    opacity: 1;
    transform: translateX(0);
    pointer-events: auto; /* Cho phép tương tác khi hiện ra */
}

.menu-tray-img {
    height: clamp(60px, 12vw, 85px);
    width: auto;
    display: block;
}

.menu-buttons-container {
    position: absolute;
    top: 50%;
    left: 50%;
    /* Tinh chỉnh lại tọa độ để vừa với khay mới */
    transform: translate(-45%, -50%); 
    display: flex;
    /* Tăng nhẹ khoảng cách giữa 2 nút cho cân đối */
    gap: 2.5vw; 
}

/* Các CSS khác giữ nguyên */
.tray-btn {
    background: none;
    border: none;
    cursor: pointer;
    width: clamp(25px, 4vw, 35px);
    transition: transform 0.2s ease;
}
.tray-btn img {
    width: 100%;
    height: auto;
}
.tray-btn:hover { transform: scale(1.1); }

   /* --- CSS CHO HIỆU ỨNG CUỘN GIẤY --- */
@keyframes unroll {
    from {
        clip-path: inset(0 0 100% 0); /* Bắt đầu: bị che hoàn toàn từ dưới lên */
    }
    to {
        clip-path: inset(0 0 0% 0);   /* Kết thúc: hiện ra toàn bộ */
    }
}

#about-me-overlay {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 600px;
    z-index: 40;
    background-image: url('Aboutme.webp');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    background-position: center;
    aspect-ratio: 3 / 4;

    /* Thay đổi: Ẩn đi để chuẩn bị cho animation */
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease; /* Giữ lại transition này để xử lý việc đóng overlay */
}

#about-me-overlay.active {
    opacity: 1;
    pointer-events: auto;
    /* Áp dụng animation unroll đã có sẵn */
    animation: unroll 1.5s ease-out forwards;
}

#about-me-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%;
    height: auto;
    padding: 2% 5%;
    text-align: center;
    color: #433;
    overflow-y: auto;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    opacity: 0;
    /* Xóa độ trễ, JavaScript sẽ kiểm soát thời điểm hiện ra */
    transition: opacity 0.5s ease; 
}
/* --- CSS mới cho màn hình kết quả và các phần tử liên quan --- */
#end-screen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 50;
    opacity: 0;
    transition: opacity 1s ease-in-out;
}

#end-screen-overlay.active {
    display: flex;
    opacity: 1;
}

#end-screen-container {
    width: 90%;
    max-width: 700px;
    height: auto;
    position: relative;
    background-image: url('End.webp');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    background-position: center;
    padding: 5% 10%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    text-align: center;
    animation: fadeInScale 1s ease-in-out;
}

.result-frame {
    width: 100%;
    height: auto;
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    position: relative;
    padding: 0 5%;
}

.result-box {
   /* Đảm bảo flexbox hoạt động đúng để căn giữa */
    display: flex;
    justify-content: center;
    align-items: center;
    /* Giữ các thuộc tính hiện tại */
    background-image: url('Sc.webp');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    min-height: 80px;
    padding: 2% 10%;
    margin-bottom: 1rem;
}

.result-text {
   /* Đảm bảo text được căn giữa trong chính nó */
    text-align: center;
    /* Các thuộc tính khác giữ nguyên */
    font-size: clamp(1rem, 2.5vw, 1.25rem);
    font-weight: bold;
    color: #333;
    line-height: 1.2;
    width: 100%;
    width: 100%; /* Chiếm toàn bộ chiều ngang của thẻ cha */
    line-height: 1.2; /* Tùy chỉnh line-height để tránh tràn viền */
    margin: 0; /* Xóa margin không mong muốn */
    padding: 0; /* Xóa padding không mong muốn */
}
.evaluation-box-top {
   /* Đảm bảo nội dung được căn giữa hoàn hảo */
    display: flex;
    justify-content: center;
    align-items: center;
    /* Giữ các thuộc tính hiện tại */
    width: clamp(250px, 80%, 400px);
    height: auto;
    background-image: url('Sc.webp');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    min-height: 80px;
    padding: 2% 10%;
    margin-bottom: 3rem;
}

#star-rating {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.star {
    width: clamp(50px, 10vw, 70px); /* Đã Tăng Kích Thước */
    height: auto;
    margin: 0 5px;
}

#end-buttons-container {
    position: absolute;
    bottom: 5%;
    display: flex;
    justify-content: center;
    gap: 1rem;
}

#end-replay-btn, #end-exit-btn {
    font-size: var(--font-size-md);
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px #388e3c;
    font-weight: 700;
}

#end-replay-btn {
    background-color: #4caf50;
    color: white;
    border: none;
}

#end-exit-btn {
    background-color: #f44336;
    color: white;
    border: none;
}

#end-replay-btn:hover {
    background-color: #43a047;
    transform: translateY(-2px);
    box-shadow: 0 6px #388e3c;
}

#end-exit-btn:hover {
    background-color: #e53935;
    transform: translateY(-2px);
    box-shadow: 0 6px #c62828;
}

#end-replay-btn:active, #end-exit-btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px #388e3c;
}

/* Tùy chỉnh hiển thị trên màn hình lớn */
@media (min-width: 768px) {
    .result-frame {
        grid-template-columns: repeat(2, 1fr);
    }
}   
 /* THÊM CSS TẠM THỜI ĐỂ TEST */
        #test-end-screen-btn {
            position: fixed;
            top: 2vh;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: none; /* Ban đầu ẩn nút này */
        }
    </style>
  <script src="questions.js"></script> 
</head>
<body>
    <div id="dim-overlay"></div>
	<div id="menu-container">
    <button id="menu-button" class="menu-btn">
        <img src="Menu.webp" alt="Menu Button">
    </button>
    <div id="menu-tray">
        <img src="Khay.webp" alt="Menu Tray" class="menu-tray-img">
        <div class="menu-buttons-container">
            <button id="mute-button" class="tray-btn">
                <img id="mute-icon" src="Volume.webp" alt="Mute/Volume Button">
            </button>
            <button id="info-button" class="tray-btn">
                <img src="i.webp" alt="Info Button">
            </button>
        </div>
    </div>
</div>
<div id="start-screen" class="start-screen">
        <div class="logo-container">
         <img src="LogoKiemlam.png" alt="Logo Kiem Lam">
         <p>CHI CỤC KIỂM LÂM</p>
         <p>TỈNH TUYÊN QUANG</p>
         </div>
        <img src="Gametitle.png" alt="HỎI ĐÁP PHÁP LUẬT LÂM NGHIỆP" class="game-title-img">
        <button id="start-button" class="start-btn">START</button>
        <p class="author-info"><b>Game Design & Development by Phạm Tường Văn</b></p>
        
     
      <div id="about-me-overlay">
   <div id="about-me-content">
    <h2 class="letter-title">Thông điệp từ người phát triển</h2>
    <div class="letter-body">
    <p>
    <p>
    <p>
    <p>
    <p>
</div>
</div>
</div>
 </div>
    <div class="container" style="display: none;">
        <div class="logo-container">
            <img src="LogoKiemlam.png" alt="Logo Kiem Lam">
             <p>CHI CỤC KIỂM LÂM</p>
         <p>TỈNH TUYÊN QUANG</p>
        </div>
        <p class="author-info"><b>Bản quyền © 2025 Phạm Tường Văn</b></p>
        
        <div id="clock-container">
            <img src="Clock.webp" alt="Clock Frame" id="clock-frame">
            <div id="timer-container">
                <span id="timer"></span>
            </div>
        </div>

        <button id="exit-button" class="exit-btn">
    <img src="Home.webp" alt="Home Button">
</button>
        <button id="replay-button" class="replay-btn" style="display: none;">
            <img src="Replay.webp" alt="Replay Button">
        </button>


        <div id="score-board">
            <img src="Count.png" alt="Score Board" class="score-board-frame">
            <div class="score-text-container">
                <p id="correct-count">Đ 0/20</p>
                <p id="incorrect-count">S 0/20</p>
            </div>
        </div>

        <div class="quiz-wrapper">
            <div id="question-frame" class="question-frame">
                <div id="question-card-container"></div>
            </div>
            <div id="answers-container"></div>
            </div>

        <div id="chibi-assistant" class="chibi-assistant">
            <video id="chibi-video" muted playsinline></video>
        </div>

        <div class="overlay-answer" id="overlay-answer">
            <div class="overlay-content" id="overlay-answer-content">
                <h3 id="overlay-text"></h3>
                <p id="overlay-explanation"></p>
            </div>
        </div>

        <div id="results-container" class="results-container" style="display: none;">
            <p id="result-text" class="result-text"></p>
            <button id="restart-btn" class="restart-btn">Làm lại</button>
        </div>
        
        <button id="next-button" class="next-btn" style="display: none;">
            <img src="Arrow.png" alt="Next Question">
        </button>
    </div>

    <div id="end-screen-overlay">
    <div id="end-screen-container">
    <div class="evaluation-box-top">
        <span id="evaluation-text" class="result-text"></span>
    </div>
    <div id="star-rating"></div>
    <div class="result-box">
        <span id="final-stats-text" class="result-text"></span>
    </div>
    <div class="result-box">
        <span id="avg-time-text" class="result-text"></span>
    </div>
    <button id="end-replay-btn" class="restart-btn">Chơi Lại</button>
    <button id="end-exit-btn" class="restart-btn">Thoát</button>
</div>
</div>

    <script>
      
        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const mainContainer = document.querySelector('.container');
        const resultsContainer = document.getElementById('results-container');
        const resultText = document.getElementById('result-text');
        const restartBtn = document.getElementById('restart-btn');
        const timerContainer = document.getElementById('timer-container');
        const timerElement = document.getElementById('timer');
        const exitButton = document.getElementById('exit-button');
        const dimOverlay = document.getElementById('dim-overlay'); // <-- THÊM DÒNG NÀY
        const replayButton = document.getElementById('replay-button'); // Thêm dòng này
        const nextBtn = document.getElementById('next-button');
        const overlayAnswer = document.getElementById('overlay-answer');
        const overlayText = document.getElementById('overlay-text');
        const chibiAssistant = document.getElementById('chibi-assistant');
        const chibiVideo = document.getElementById('chibi-video');
        const overlayExplanation = document.getElementById('overlay-explanation');
       
        // --- DOM Elements for Quiz Content ---
        const questionCardContainer = document.getElementById('question-card-container');
        const answersContainer = document.getElementById('answers-container');
        
        // --- DOM Elements for Score Board ---
        const scoreBoard = document.getElementById('score-board');
        const correctCountElement = document.getElementById('correct-count');
        const incorrectCountElement = document.getElementById('incorrect-count');

        // --- DOM Elements for Menu and About Me ---
        const menuButton = document.getElementById('menu-button');
        const menuTray = document.getElementById('menu-tray');
        const muteButton = document.getElementById('mute-button');
        const muteIcon = document.getElementById('mute-icon');
        const infoButton = document.getElementById('info-button');
        const aboutMeOverlay = document.getElementById('about-me-overlay');
        
        // --- Thêm các biến DOM mới cho màn hình kết quả ---
        const endScreenOverlay = document.getElementById('end-screen-overlay');
        const endScreenContainer = document.getElementById('end-screen-container');
        const evaluationText = document.getElementById('evaluation-text');
        const starRating = document.getElementById('star-rating');
        const finalStatsText = document.getElementById('final-stats-text');
        const avgTimeText = document.getElementById('avg-time-text');
        const endReplayBtn = document.getElementById('end-replay-btn');
        const endExitBtn = document.getElementById('end-exit-btn');
        
        
        // --- Sounds ---
        const themeMusic = new Audio('Theme.mp3');
        const clickSound = new Audio('click.mp3');
        const rightSound = new Audio('Right.mp3');
        const falseSound = new Audio('False.mp3');
        const tenSecondsSound = new Audio('10s.mp3');
        const latGiaySound = new Audio('Latgiay.mp3'); 
        
        themeMusic.loop = true;
        themeMusic.volume = 0.3;
        rightSound.volume = 0.3;
        falseSound.volume = 0.2;
        tenSecondsSound.volume = 0.3;
        latGiaySound.volume = 0.5;
        clickSound.volume = 0.3
        
        // --- Game State ---
        const totalQuestions = 20;
        let score = 0;
        let currentQuestionIndex = 0;
        let timerInterval;
        let shuffledQuestions;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let totalTimeSpent = 0;
        let timeStartPerQuestion = 0;
        // --- Functions ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

       function startQuiz() {
            // Đảm bảo ẩn màn hình kết thúc nếu nó đang hiển thị
            endScreenOverlay.classList.remove('active');
            endScreenOverlay.style.display = 'none'; // Thêm dòng này để ẩn hoàn toàn màn hình kết thúc

            score = 0;
            currentQuestionIndex = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            totalTimeSpent = 0;
            
            // Đảm bảo các màn hình và nút được hiển thị lại đúng cách
            resultsContainer.style.display = 'none';
            timerContainer.style.display = 'block';
            exitButton.style.display = 'block';
            replayButton.style.display = 'block';
            chibiAssistant.style.display = 'block';
            nextBtn.style.display = 'none';
            overlayAnswer.style.display = 'none';
            overlayText.style.opacity = 0;
            overlayExplanation.style.opacity = 0;
            scoreBoard.classList.add('active');
            updateScoreBoard();
            
            // Xáo trộn lại câu hỏi và bắt đầu trò chơi mới
            shuffledQuestions = shuffle([...questions]).slice(0, totalQuestions);
            
            showNextQuestion();
        }

       function showNextQuestion() {
    if (currentQuestionIndex < totalQuestions) {
        const q = shuffledQuestions[currentQuestionIndex];
        
        questionCardContainer.innerHTML = '';
        answersContainer.innerHTML = '';

        const questionElement = document.createElement('div');
        questionElement.classList.add('question-card');
        const questionTextElement = document.createElement('div');
        questionTextElement.classList.add('question-text');
        questionElement.appendChild(questionTextElement);
        questionCardContainer.appendChild(questionElement);

        const answersElement = document.createElement('div');
        answersElement.classList.add('answers');
        answersElement.dataset.correctAnswer = q.correct;
        answersContainer.appendChild(answersElement);
        
        playChibiVideo('Ask.mp4');

        // Bổ sung dòng code này để đảm bảo video luôn được phát trên mobile
        const playPromise = chibiVideo.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                // Autoplay bị chặn, không cần làm gì thêm vì logic video tiếp theo sẽ tự động chạy
            });
        }

        typeWriterEffect(questionTextElement, `Câu ${currentQuestionIndex + 1}: ${q.question}`, () => {
            createAndShowAnswers(answersElement, q.options);
        });
        
    } else {
        showResults();
    }
}

        function createAndShowAnswers(answersElement, options) {
            const answerLabels = ['A', 'B', 'C', 'D'];
            // SẮP XẾP NGẪU NHIÊN CÁC ĐÁP ÁN
            const shuffledOptions = shuffle([...options]);
            answersElement.innerHTML = shuffledOptions.map((option, index) => 
    `<button class="answer-btn">${answerLabels[index]}. ${option}</button>`
).join('');

            answersElement.classList.add('visible');
            const answerButtons = Array.from(answersElement.children);
            let delay = 0;
            answerButtons.forEach((btn, index) => {
                setTimeout(() => {
                    btn.classList.add('show');
                    if (index === answerButtons.length - 1) {
                        answerButtons.forEach(b => b.addEventListener('click', handleAnswer));
                        startTimer();
                    }
                }, delay);
                delay += 200; // Độ trễ giữa các đáp án
            });
        }
        
        function typeWriterEffect(element, text, callback, speed = 25) {
            let i = 0;
            element.textContent = '';
            
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else if (callback) {
                    callback();
                }
            }
            type();
        }

      function startTimer() {
timeStartPerQuestion = new Date().getTime(); // Ghi lại thời điểm bắt đầu đếm giờ    
let timeLeft = 60;
    timerElement.textContent = timeLeft;
    timerElement.style.color = '#ffc107'; // Thay đổi thành màu vàng

    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timeLeft--;
        timerElement.textContent = timeLeft;

        // Bổ sung điều kiện phát nhạc khi đếm ngược về 10
        if (timeLeft <= 10) {
            // Kiểm tra để tránh phát lại nhiều lần
            if (timeLeft === 10) {
                tenSecondsSound.play();
            }
            timerElement.style.color = 'var(--incorrect-color)'; // Đổi sang màu đỏ
        }

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            handleAnswerTimeout();
           totalTimeSpent += 60;
        }
    }, 1000);
}

        function updateScoreBoard() {
            correctCountElement.textContent = `Đ ${correctAnswers}/${totalQuestions}`;
            incorrectCountElement.textContent = `S ${incorrectAnswers}/${totalQuestions}`;
        }

       function handleAnswer(event) {
    clearInterval(timerInterval);
const timeEndPerQuestion = new Date().getTime();
const timeSpent = (timeEndPerQuestion - timeStartPerQuestion) / 1000; // Đổi sang giây
totalTimeSpent += timeSpent;
    const selectedBtn = event.currentTarget;
    const parentAnswers = selectedBtn.closest('.answers');
    const correctAnswer = parentAnswers.dataset.correctAnswer;

    // Vô hiệu hóa tất cả các nút đáp án và làm mờ
    Array.from(parentAnswers.children).forEach(btn => {
        btn.classList.add('disabled');
    });

    const selectedText = selectedBtn.textContent.substring(3).trim();
    if (selectedText === correctAnswer) {
        selectedBtn.classList.add('correct');
        correctAnswers++;
        rightSound.play();
        playChibiVideo('True.mp4');
        nextBtn.style.display = 'block';
    } else {
        selectedBtn.classList.add('incorrect');
        incorrectAnswers++;
        falseSound.play();
        playChibiVideo('Sad.mp4');

        // Hiển thị đáp án đúng
        Array.from(parentAnswers.children).forEach(btn => {
            if (btn.textContent.substring(3).trim() === correctAnswer) {
                btn.classList.add('correct');
            }
        });

        // Thêm độ trễ 1.5 giây trước khi hiển thị overlay
        setTimeout(() => {
            showCorrectAnswerOverlay(correctAnswer);
        }, 1500); // 1500 miligiây = 1.5 giây
    }
    updateScoreBoard();
}

        function handleAnswerTimeout() {
            clearInterval(timerInterval);
            const currentAnswers = answersContainer.querySelector('.answers');
            if (!currentAnswers) return;

            incorrectAnswers++;
            updateScoreBoard();
            
            const correctAnswer = currentAnswers.dataset.correctAnswer;
            
            // Vô hiệu hóa và hiển thị đáp án đúng khi hết giờ
            Array.from(currentAnswers.children).forEach(btn => {
                btn.classList.add('disabled');
                if (btn.textContent.substring(3).trim() === correctAnswer) {
                    btn.classList.add('correct');
                }
            });
            playChibiVideo('Sad.mp4');
            showCorrectAnswerOverlay(correctAnswer);
        }

       function showCorrectAnswerOverlay(correctAnswerText) {
            dimOverlay.classList.add('active'); // Kích hoạt lớp phủ tối
            latGiaySound.play().catch(e => console.log("Phát tiếng lật giấy thất bại:", e));
    
            // Lấy explanation từ câu hỏi hiện tại
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const explanationText = currentQuestion.explanation;

            overlayAnswer.style.display = 'flex';
            overlayAnswer.classList.add('active'); // Kích hoạt animation zoomIn

            // Đợi animation zoomIn kết thúc rồi mới gõ chữ
            overlayAnswer.addEventListener('animationend', () => {
                overlayText.style.opacity = 1; // Hiện element chứa text
                typeWriterEffect(overlayText, `Đáp án đúng là:\n${correctAnswerText}`, () => {
                    // Khi gõ xong đáp án, bắt đầu gõ phần giải thích
                    if (explanationText) {
                        overlayExplanation.style.opacity = 1; // Hiện element chứa giải thích
                        typeWriterEffect(overlayExplanation, explanationText, () => {
                            nextBtn.style.display = 'block';
                        }, 20); // Tốc độ gõ chữ chậm hơn một chút cho phần giải thích
                    } else {
                        nextBtn.style.display = 'block';
                    }
                }, 40); // Tốc độ gõ chữ cho đáp án
            }, { once: true }); // Chỉ chạy event listener này một lần
        }

        // --- Hàm showResults() đã được cập nhật ---
        function showResults() {
            questionCardContainer.innerHTML = '';
            answersContainer.innerHTML = '';
            resultsContainer.style.display = 'none'; // Ẩn màn hình kết quả cũ
            timerContainer.style.display = 'none';
            exitButton.style.display = 'none';
            replayButton.style.display = 'none';
            chibiAssistant.style.display = 'none';
            overlayAnswer.style.display = 'none';
            nextBtn.style.display = 'none';
            scoreBoard.classList.remove('active');
        
            // Hiển thị màn hình tổng kết mới
            endScreenOverlay.style.display = 'flex';
            setTimeout(() => endScreenOverlay.classList.add('active'), 50);

            // Hiển thị nội dung tổng kết
            displayEvaluation();
            displayStars();
            displayFinalStats();
            displayAvgTime();
        }
        
        function resetGame() {
            clearInterval(timerInterval);
            mainContainer.style.display = 'none';
            startScreen.classList.remove('hidden');
            scoreBoard.classList.remove('active');
            replayButton.style.display = 'none'; // Ẩn nút Replay khi thoát game
            themeMusic.pause();
            themeMusic.currentTime = 0; // Đặt lại thời gian nhạc về 0
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', () => {
            clickSound.play();
            startScreen.classList.add('hidden');
            mainContainer.style.display = 'flex';
            startQuiz();
            
            if (themeMusic.paused) {
                themeMusic.play().catch(e => console.log("Phát nhạc nền thất bại:", e));
            }
        });
        
        exitButton.addEventListener('click', () => {
            clickSound.play();
            resetGame();
        });
        
        replayButton.addEventListener('click', () => {
            clickSound.play();
            startQuiz();
        });

        restartBtn.addEventListener('click', () => {
            clickSound.play();
            startQuiz();
        });

       nextBtn.addEventListener('click', () => {
            clickSound.play();
            nextBtn.style.display = 'none';
            dimOverlay.classList.remove('active'); // Ẩn lớp phủ tối
            
            // Ẩn overlay và reset các thông tin
            overlayAnswer.classList.remove('active');
            overlayText.style.opacity = 0;
            overlayText.textContent = '';
            overlayExplanation.style.opacity = 0;
            overlayExplanation.textContent = '';
            
            // Thêm hiệu ứng fade-out cho khung câu hỏi hiện tại
            const quizWrapper = document.querySelector('.quiz-wrapper');
            quizWrapper.classList.add('fade-out');

            // Chờ hiệu ứng kết thúc rồi mới chuyển sang câu hỏi mới
            setTimeout(() => {
                // Reset lại vị trí và độ trong suốt
                quizWrapper.classList.remove('fade-out');
                quizWrapper.style.opacity = 1; // Đảm bảo hiện lại

                currentQuestionIndex++;
                showNextQuestion();
            }, 1000); // 1000ms = 1 giây
        });

        // =================================================================
        // SỬA LỖI: Di chuyển event listeners của màn hình kết thúc ra ngoài
        // để chúng chỉ được đăng ký một lần duy nhất.
        // =================================================================
        endReplayBtn.addEventListener('click', () => {
            clickSound.play();
            endScreenOverlay.classList.remove('active');
            
            // Chờ 1000ms (1 giây) cho hiệu ứng làm mờ hoàn tất
            setTimeout(() => {
                endScreenOverlay.style.display = 'none'; // Ẩn hẳn overlay
                startQuiz();
            }, 1000); 
        });

        endExitBtn.addEventListener('click', () => {
            clickSound.play();
            endScreenOverlay.classList.remove('active');
            
            // SỬA LỖI: Chờ 1000ms (1 giây), đúng bằng thời gian transition trong CSS
            setTimeout(() => {
                endScreenOverlay.style.display = 'none'; // Ẩn hẳn overlay để không chặn click
                resetGame();
            }, 1000);
        });
        // =================================================================

       function playChibiVideo(videoSrc) {
    // Đặt lại các thuộc tính mặc định
    chibiVideo.playbackRate = 1.0;
    chibiVideo.onended = null;
    chibiVideo.loop = false;

    // Chuyển nguồn video
    chibiVideo.src = videoSrc;

    // Thiết lập hành vi cho từng loại video
    if (videoSrc === 'Ask.mp4') {
        chibiVideo.onended = () => {
            playChibiVideo('Wait.mp4');
        };
    } else if (videoSrc === 'Wait.mp4') {
        chibiVideo.loop = true;
        chibiVideo.playbackRate = 0.6;
    } else if (videoSrc === 'True.mp4' || videoSrc === 'Sad.mp4') {
        chibiVideo.onended = () => {
            playChibiVideo('Wait2.mp4');
        };
    } else if (videoSrc === 'Wait2.mp4') {
        chibiVideo.loop = true;
    }

    // Bắt đầu phát video
    chibiVideo.play().catch(e => console.log("Lỗi phát video chibi:", e));
}
function setRealVh() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }
  setRealVh();
  window.addEventListener('resize', setRealVh);
  window.addEventListener('orientationchange', setRealVh);
  
// --- Event Listeners cho các tính năng mới ---
// Nút Menu
menuButton.addEventListener('click', () => {
    clickSound.play();
    menuTray.classList.toggle('active');
    // Nếu khay đang ẩn, đảm bảo bảng About Me cũng ẩn
    if (!menuTray.classList.contains('active')) {
        aboutMeOverlay.classList.remove('active');
    }
});

// Nút Tắt/Bật âm thanh
muteButton.addEventListener('click', () => {
    // Nếu nhạc đang chạy và không bị tắt
    if (themeMusic.muted === false) {
        themeMusic.muted = true;
        rightSound.muted = true;
        falseSound.muted = true;
        tenSecondsSound.muted = true;
        latGiaySound.muted = true;
        clickSound.muted = true;
        muteIcon.src = 'Mute.webp'; // Thay đổi icon thành Mute
    } else {
        themeMusic.muted = false;
        rightSound.muted = false;
        falseSound.muted = false;
        tenSecondsSound.muted = false;
        latGiaySound.muted = false;
        clickSound.muted = false;
        muteIcon.src = 'Volume.webp'; // Thay đổi icon thành Volume
        clickSound.play();
    }
});

// Nút Giới thiệu (ĐÃ CẬP NHẬT HIỆU ỨNG)
infoButton.addEventListener('click', () => {
    clickSound.play();
    const isAlreadyActive = aboutMeOverlay.classList.contains('active');
    const contentContainer = aboutMeOverlay.querySelector('#about-me-content');
    const titleElement = aboutMeOverlay.querySelector('.letter-title');

    if (isAlreadyActive) {
        aboutMeOverlay.classList.remove('active');
        aboutMeOverlay.style.animation = 'none';
        contentContainer.style.opacity = '0';
    } else {
        titleElement.textContent = ''; // Xóa nội dung cũ
        
        const originalTitle = "Thông điệp từ người phát triển";
        const originalBodies = [
            "Chào các đồng nghiệp Kiểm lâm và những người yêu rừng!",
            "Dự án này không chỉ là một công cụ giải trí mà còn là tâm huyết của tôi, một Kiểm lâm viên, với mong muốn tạo ra một phương tiện học tập mới mẻ và thú vị.",
            "Qua mỗi câu hỏi, tôi hy vọng chúng ta có thể củng cố và trau dồi kiến thức về pháp luật về Lâm nghiệp, một hành trang không thể thiếu trong công tác bảo vệ và phát triển rừng.",
            "Chúc các bạn có những giây phút thư giãn và học hỏi thật hiệu quả./.",
            "Trân trọng,\nPhạm Tường Văn"
        ];

        aboutMeOverlay.style.animation = '';
        aboutMeOverlay.classList.add('active');
        latGiaySound.play();

        aboutMeOverlay.addEventListener('animationend', () => {
            contentContainer.style.opacity = '1';
            const bodyParagraphs = contentContainer.querySelectorAll('.letter-body p');
            
            let pIndex = 0;
            const typeNextParagraph = () => {
                if (pIndex < originalBodies.length) {
                    typeWriterEffect(bodyParagraphs[pIndex], originalBodies[pIndex], typeNextParagraph, 20);
                    pIndex++;
                }
            };
            
            typeWriterEffect(titleElement, originalTitle, typeNextParagraph, 50);
            
        }, { once: true });
    }
});
 // --- Thêm các hàm xử lý mới cho màn hình kết quả ---
    // Hàm hiển thị đánh giá
    function displayEvaluation() {
        let evaluation = '';
        if (correctAnswers <= 3) {
            evaluation = 'HỌC LẠI NGAY';
        } else if (correctAnswers >= 4 && correctAnswers <= 7) {
            evaluation = 'PHẢI HỌC THÊM';
        } else if (correctAnswers >= 8 && correctAnswers <= 11) {
            evaluation = 'TẠM ỔN ĐẤY';
        } else if (correctAnswers >= 12 && correctAnswers <= 15) {
            evaluation = 'GẦN BẰNG KIỂM LÂM';
        } else if (correctAnswers >= 16 && correctAnswers <= 19) {
            evaluation = 'CHUYÊN GIA LUẬT RỪNG';
        } else if (correctAnswers === 20) {
            evaluation = 'XUẤT SẮC';
        }
        evaluationText.textContent = evaluation;
    }

    // Hàm hiển thị điểm sao
    function displayStars() {
        let starCount = 0;
        if (correctAnswers >= 4) starCount = 1;
        if (correctAnswers >= 8) starCount = 2;
        if (correctAnswers >= 12) starCount = 3;
        if (correctAnswers >= 16) starCount = 4;
        if (correctAnswers >= 20) starCount = 5;

        starRating.innerHTML = ''; // Xóa sao cũ
        for (let i = 0; i < 5; i++) {
            const starImg = document.createElement('img');
            starImg.classList.add('star');
            if (i < starCount) {
                starImg.src = '1.webp'; // Sao vàng
                starImg.alt = 'Filled Star';
            } else {
                starImg.src = '0.webp'; // Sao xám
                starImg.alt = 'Empty Star';
            }
            starRating.appendChild(starImg);
        }
    }

    // Hàm hiển thị tổng kết đúng/sai
    function displayFinalStats() {
        finalStatsText.textContent = `Đúng: ${correctAnswers}/${totalQuestions}\nSai: ${incorrectAnswers}/${totalQuestions}`;
    }

    // Hàm hiển thị thời gian trung bình (cần thêm logic tính toán)
    function displayAvgTime() {
    const avgTime = (totalTimeSpent / totalQuestions).toFixed(1); // Làm tròn 1 chữ số thập phân
    avgTimeText.textContent = `Thời gian trung bình:\n${avgTime}s/câu`;
}
        
// --- Đoạn mã mới để kiểm tra màn hình kết thúc ---
        function testEndScreen(correct, incorrect, totalTime) {
            // Thiết lập các biến trạng thái trò chơi
            correctAnswers = correct;
            incorrectAnswers = incorrect;
            totalTimeSpent = totalTime;
            
            // Gọi hàm hiển thị màn hình kết quả
            showResults();
        }

        // --- Gắn nút kiểm tra (Tùy chọn) ---
        // Bạn có thể thêm một nút ẩn để dễ dàng gọi hàm này
        // Ví dụ: Tạo một nút trong HTML có id="test-btn"
        // <button id="test-btn" style="position: absolute; bottom: 10px; right: 10px;">Test End Screen</button>
        // Sau đó thêm mã JS này vào đây:
        // const testButton = document.getElementById('test-btn');
        // if (testButton) {
        //    testButton.addEventListener('click', () => {
        //        // Gọi hàm test với số liệu mong muốn
        //        // Ví dụ: 20 câu đúng, 5 câu sai, tổng thời gian 300 giây
        //        testEndScreen(20, 5, 300);
        //    });
        // }
        
        // --- Hướng dẫn cách sử dụng đơn giản nhất ---
        // Để kiểm tra nhanh, bạn chỉ cần mở trình duyệt, nhấn F12 để mở Console,
        // sau đó gõ lệnh dưới đây và Enter:
        // testEndScreen(25, 0, 150);
        // (Ví dụ
        </script>
</body>
</html>
